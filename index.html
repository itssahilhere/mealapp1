<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>My Meal Appü§§</title>
    <link
      rel="icon"
      href="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSiN4XaaDyGf61vQaM4E0P0t8R7D_RgSW2rGQ&usqp=CAU    "
      type="image/x-icon"
    />
    <script
      src="https://kit.fontawesome.com/2eafec57ec.js"
      crossorigin="anonymous"
    ></script>

    <link href="mealstyle.css" rel="stylesheet" />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      crossorigin="anonymous"
    />
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.min.js"
      crossorigin="anonymous"
    ></script>

    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
      }
      /* nav-Section */
      #nav {
        background-color: #ff5b22;
      }
      @keyframes rotate {
        from {
          transform: rotate(0deg);
        }
        to {
          transform: rotate(360deg);
        }
      }

      #app-icon {
        box-shadow: 0px 0px 20px 1px;
        animation: rotate 1s ease-in-out infinite;
      }

      /* Web page Body section */
      .body-container {
        display: flex;
        flex-direction: column;
        height: 100%;
      }

      /* Header section of page */
      header {
        background-color: #ff9130;
        color: whitesmoke;
        text-align: center;
        padding: 20px;
        height: 50vh;
      }

      header h1 {
        margin-top: 10%;
        color: white;
        font-family: monospace;
      }

      /* result sectionof page */
      main {
        padding: 20px;
        display: flex;
        flex-wrap: wrap;
        justify-content: space-around;
        background-color: #9a3b3b;
        height: 100%;
      }
      #dummy-text {
        height: 100vh;
        width: 100%;
        position: relative;
        text-align: center;
        color: #c63d2f;
        top: 50%;
        font-size: 4rem;
        font-family: monospace;
        background-color: #e2c799;
      }
      .no-result {
        height: 100vh;
        width: 100vh;
        position: relative;
        text-align: center;
        color: #000000;
        top: 10%;
        left: 20%;
        font-size: 2rem;
        font-family: monospace;
        background-color: #dac0a3;
      }

      /* Search Input */
      #mealSearchInput {
        width: 50%;
        padding: 10px;
        border: none;
        border-radius: 5px;
        margin-bottom: 20px;
        margin: 30px;
      }

      /* Meal Grid */
      .meal-grid {
        display: flex;
        flex-wrap: wrap;
        justify-content: space-between;
        width: 80%;
        gap: 20px;
      }

      .meal-item {
        display: flex;
        flex-wrap: wrap;
        background-color: #4e4343;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        border-radius: 10px;
        row-gap: 10px;
        overflow: hidden;
      }

      .meal-item h3 {
        width: 100%;
        font-size: 18px;
        padding: 10px;
        font-size: x1.2rem;
        color: #fff;
      }

      .meal-item img {
        width: 100%;
        height: auto;
        opacity: 0.8;
        border-radius: 50%;
        transition: 0.5s ease-in-out;
      }
      .meal-item img:hover {
        transform: scale(1.05);
      }

      .card {
        row-gap: 15px;
      }

      /* Buttons Section */
      .offcanvas-body {
        row-gap: 20px;
      }
      .offcanvas-header {
        background-color: #b2533e;
      }
      .favorite-btn {
        width: 50%;
        background-color: #6c3428;
        color: antiquewhite;
        font-family: monospace;
        font-size: 1.2rem;
        border-radius: 0.5rem;
      }
      .favorite-btn:hover {
        background-color: #9a3b3b;
      }

      /* Recipe Button */
      .details-btn {
        width: 50%;
        background-color: #a86464;
        color: antiquewhite;
        font-family: monospace;
        font-size: 1rem;
        border-radius: 0.5rem;
      }
      .details-btn:hover {
        background-color: #567189;
      }
      .remove-btn {
        width: 50%;
        background-color: #cd1818;
        color: antiquewhite;
        font-family: monospace;
        font-size: 1rem;
        border-radius: 0.5rem;
      }
      .back-button {
        background-color: white;
        border: none;
        color: #765827;
        font-size: 1.5rem;
      }
    </style>
  </head>
  <body>
    <!-- Nav-Bar section -->
    <div id="nav" class="navbar navbar-dark fixed-top">
      <div class="container-fluid">
        <img
          id="app-icon"
          style="height: 60px; width: 60px; border-radius: 50%"
          src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTA8ubpOUI0gsie9xGQJP_8iLAYFLEHnltzaQ&usqp=CAU"
        />
        <a
          style="font-weight: 500; font-size: 50px"
          class="navbar-brand"
          href="index.html"
          >Meal Appü§§</a
        >

        <!-- Nav-Bar toggler for FavoriteList -->
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="offcanvas"
          data-bs-target="#offcanvasNavbar"
          aria-controls="offcanvasNavbar"
          onclick="showFavMealList()"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div
          class="offcanvas offcanvas-end"
          tabindex="-1"
          id="offcanvasNavbar"
          aria-labelledby="offcanvasNavbarLabel"
        >
          <!-- Header of FavoriteList -->
          <div class="offcanvas-header">
            <h5
              class="offcanvas-title"
              id="offcanvasNavbarLabel"
              style="color: white"
            >
              Your Favourites are Here.!
            </h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="offcanvas"
              aria-label="Close"
            ></button>
          </div>

          <!-- Body of FavoriteList -->
          <div
            id="favourites-body"
            class="offcanvas-body d-flex justify-content-center flex-wrap"
          >
            <div class="meal-card" id="meal">
              <!-- Meal content -->
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- Body of WebPage -->
    <div class="body-container">
      <!-- Title and Input section -->
      <header>
        <h1>Find Your Food Here üçîüçî!!</h1>
        <input
          type="text"
          id="mealSearchInput"
          placeholder="Search for a meal"
        />
      </header>

      <main>
        <div id="searchResults" class="meal-grid">
          <!-- Search results will be displayed here -->
        </div>
        <div id="dummy-text">Your food is getting ready here üòãüòã!!...</div>
      </main>
    </div>

    <script type="text/javascript">
      const mealSearchInput = document.getElementById("mealSearchInput");
      const searchResults = document.getElementById("searchResults");
      const dummyDiv = document.getElementById("dummy-text"); // Holds result position when no result
      const favoriteList = document.getElementById("favourites-body"); // Updated selection
      const favorites = [];

      // Function to fetch meals based on search input
      async function searchMeals(query) {
        // Clear previous search results
        searchResults.innerHTML = "";
        if (query.trim() === "") {
          dummyDiv.style.display = "block";
          return;
        }
        try {
          const response = await fetch(
            `https://www.themealdb.com/api/json/v1/1/search.php?s=${query}`
          );
          const data = await response.json();
          if (data.meals) {
            dummyDiv.style.display = "none";
            data.meals.forEach((meal) => {
              const mealItem = document.createElement("div");
              mealItem.classList.add("meal-item");
              mealItem.style.width = "30%";
              mealItem.style.display = "flex";
              mealItem.style.flexWrap = "wrap";
              mealItem.innerHTML = `
                    <h3 style='text-align:center'>${meal.strMeal}</h3>
                    <img id="meal-image" src="${meal.strMealThumb}" alt="${meal.strMeal}">
                    <button id="fav-btn" class="favorite-btn" data-mealid="${meal.idMeal}">Favourite</button>
                    <button class="details-btn" data-mealid="${meal.idMeal}">Recipe</button>
                `;

              searchResults.appendChild(mealItem);
            });

            // Handle "Favorite" button clicks
            const favoriteButtons = document.querySelectorAll(".favorite-btn");
            favoriteButtons.forEach((btn) => {
              btn.addEventListener("click", addToFavorites);
            });

            // Handle "Details" button clicks
            const detailsButtons = document.querySelectorAll(".details-btn");
            detailsButtons.forEach((btn) => {
              btn.addEventListener("click", showMealDetails);
            });
          } else {
            searchResults.innerHTML =
              "<div class='no-result'>No meals found. Please try a different search.</div>";
          }
        } catch (error) {
          console.error("Error fetching data from API:", error);
        }
      }

      // Function to add a meal to favorites
      function addToFavorites(event) {
        const mealDiv = event.target.parentElement; // Get the parent div (the meal div)
        favorites.push(mealDiv);
        updateFavoriteList();
        window.alert("Meal added to Favorites!!");
      }

      // Function to update the favorite list
      function updateFavoriteList() {
        favoriteList.innerHTML = "";
        favorites.forEach((mealDiv) => {
          const copiedMealDiv = mealDiv.cloneNode(true);
          copiedMealDiv.style.width = "100%";
          copiedMealDiv.style.display = "flex";
          copiedMealDiv.style.flexWrap = "wrap";

          // Remove "Favorite" button in favoriteList section
          const favoriteButton = copiedMealDiv.querySelector(".favorite-btn");
          if (favoriteButton) {
            favoriteButton.remove();
          }
          copiedMealDiv.innerHTML += `
            <button class="remove-btn" data-mealid="${mealDiv
              .querySelector(".favorite-btn")
              .getAttribute("data-mealid")}">Remove</button>
        `;

          favoriteList.appendChild(copiedMealDiv);

          // Handling "Details" button in favoriteList section
          const detailsButtons = copiedMealDiv.querySelectorAll(".details-btn");
          detailsButtons.forEach((btn) => {
            btn.addEventListener('click', (event) => {
        console.log("Recipe button clicked!");
        showMealDetails(event);
    });
          });
        });

        localStorage.setItem("favoriteList", favoriteList.innerHTML); //for Storage of FavoriteList
      }

      favoriteList.addEventListener("click", (event) => {
        if (event.target.classList.contains("remove-btn")) {
          const mealId = event.target.getAttribute("data-mealid");
          // Find the corresponding copiedMealDiv and remove it from favorites
          const indexToRemove = favorites.findIndex(
            (mealDiv) =>
              mealDiv
                .querySelector(".favorite-btn")
                .getAttribute("data-mealid") === mealId
          );

          if (indexToRemove !== -1) {
            favorites.splice(indexToRemove, 1);
            updateFavoriteList();
            window.alert("Meal removed from Favorites");
          }
        }
      });

      function showMealDetails(event) {
        const mealId = event.target.getAttribute("data-mealid");
        // Fetch meal details based on the mealId
        console.log("Meal ID:", mealId);
        fetch(`https://www.themealdb.com/api/json/v1/1/lookup.php?i=${mealId}`)
          .then((response) => response.json())
          .then((data) => {
            const mealDetails = data.meals[0];
            // Create a container div for the card
            const cardDiv = document.createElement("div");
            cardDiv.style.display = "flex";
            cardDiv.style.flexDirection = "column";
            cardDiv.style.alignItems = "center";
            cardDiv.classList.add("card");

            // Create an image element and reduce its size
            const imageElement = document.createElement("img");
            imageElement.src = mealDetails.strMealThumb;
            imageElement.alt = mealDetails.strMeal;
            imageElement.classList.add("card-img-top");
            imageElement.style.maxWidth = "30%"; // Adjust the size as needed
            imageElement.style.maxHeight = "200px";
            // Create a div for card body
            const cardBody = document.createElement("div");
            cardBody.classList.add("card-body");

            // Handle the click event for the back button
            const backButton = document.createElement("button");
            backButton.id = "backButton";
            backButton.classList.add("back-button");
            backButton.innerHTML = '<i class="fa-solid fa-house"></i>';
            backButton.addEventListener("click", () => {
              // Remove the card and show the search results again (going back to the homepage)
              searchResults.removeChild(cardDiv);
            });
            cardDiv.appendChild(backButton);

            // Populate the card body with meal details
            cardBody.innerHTML = `
                <h5 class="card-title">${mealDetails.strMeal}</h5>
                <p class="card-text">Category: ${mealDetails.strCategory}</p>
                <p class="card-text">Area: ${mealDetails.strArea}</p>
                <p class="card-text">Instructions: ${mealDetails.strInstructions}</p>
                <div class="text-center">
                    <a href="${mealDetails.strYoutube}" target="_blank" class="btn btn-dark mt-3">Watch Video</a>
                </div>
            `;

            // Append the image and card body to the card container
            cardDiv.appendChild(imageElement);
            cardDiv.appendChild(cardBody);

            // Append the card to a container (e.g., searchResults)
            searchResults.innerHTML = ""; // Clear previous search results
            searchResults.appendChild(cardDiv);
          })
          .catch((error) => {
            console.error("Error fetching meal details:", error);
          });
      }

      window.addEventListener("load", () => {
        const storedFavoriteList = localStorage.getItem("favoriteList");
        if (storedFavoriteList) {
          favoriteList.innerHTML = storedFavoriteList;
        }
      });

      // Event listener for search input
      mealSearchInput.addEventListener("input", () => {
        const query = mealSearchInput.value;
        searchMeals(query);
      });

      // Initial search
      searchMeals("");
    </script>
  </body>
</html>
